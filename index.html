<!DOCTYPE html>
<head>
	<link rel="stylesheet" type="text/css" href="index.css" />
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
	<script src="./jquery.csv.min.js"></script>
    <script type="text/javascript">
		var logScale = true;
		var MCO = new Date(2020, 3-1, 18);
		google.charts.load('current', {'packages':['corechart']});
		google.charts.setOnLoadCallback(drawChartFirst);
		
		<!-- $(window).resize(function(){ -->
			<!-- drawChartDailyTotal(); -->
			<!-- drawChartDailyTotalDynamics(); -->
		<!-- }); -->
		function drawChartFirst() {
			drawChartDailyTotal();
			drawChartDailyTotalDynamics();
			drawChartDailyByStates();
			drawChartDailyDynamicsByStates();
			<!-- drawChartDailyTotal(); -->
		}
		function switchLinearLog() {
			logScale = !logScale;
			drawChartDailyTotal();
		}
		function drawChartDailyTotal() {
			$.get("./data/dailyTotal.csv", function(csvString) {
				<!-- nationwide-plot -->
				var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
				for(var i = 1; i < arrayData.length; ++i) {
					arrayData[i][0] = new Date(arrayData[i][0]);
				}
				var max = arrayData[arrayData.length-1][1];
				var axisMax = Math.pow(10, Math.ceil(Math.log(max) / Math.log(10.0)));
				var axisMin = 10.0;
				var data = new google.visualization.arrayToDataTable(arrayData);
				var options =
				{
					title: 'Daily nationwide total',
					titleTextStyle : {
						fontSize: 20
					},
					chartArea: {
						left: '20%',
						top: '20%',
						width: '70%',
						height: '70%'
					},
					hAxis: {
						title: "Date",
						minorGridlines: { count:0 },
						format: 'dd-MMM'
					},
					vAxis: {
						title: "Cases",
						minorGridlines: { count:0 },
						scaleType: logScale ? 'log' : 'null',
						viewWindow: {
							min: 10
						}
					},
					legend: {
						position: 'top',
						maxLines: 3
					},
					backgroundColor: {
						fill: 'FFFAFA'
					},
					<!-- witdh: '100%', -->
					<!-- height: $(window).width()*0.741*0.5-25 -->
					<!-- height: $(window).width()*0.739*0.5 -->
				};
				var chart = new google.visualization.LineChart(document.getElementById("nationwide-daily"));
				var formatter = new google.visualization.DateFormat({pattern: 'dd-MMM'});
				formatter.format(data, 0);
				chart.draw(data, options);
				drawAxisLine(chart, MCO, 'MCO');
				
				var tDouble = Math.log(axisMax/axisMin)/Math.log(2.0);
				if(logScale)
					for(var d = 2; d <=8; d = d + 3) {
						var anchorDate = new Date(arrayData[1][0]);
						anchorDate.setDate(anchorDate.getDate() + tDouble*d);
						var textDate = new Date(arrayData[1][0]);
						textDate.setDate(textDate.getDate() + tDouble*d - 4*d);
						drawLine(chart, arrayData[1][0], axisMin, anchorDate, axisMax);
						drawText(chart, textDate, axisMax/2.0/(1.0^d), 'Double every ' + d.toString() + ' days', 8, 0);
					}
			});
		}
		function drawChartDailyByStates() {
			$.get("./data/totalInfectedByStates.csv", function(csvString) {
				<!-- bystates-plot -->
				var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
				for(var i = 1; i < arrayData.length; ++i) {
					arrayData[i][0] = new Date(arrayData[i][0]);
				}
				var max = arrayData[arrayData.length-1][1];
				var axisMax10 = Math.pow(10, Math.ceil(Math.log(max) / Math.log(10.0)));
				var axisMax5 = 5*Math.pow(10, Math.ceil(Math.log(max/5) / Math.log(10.0)));
				var axisMax = Math.max(axisMax10, axisMax5);
				var axisMin = 10.0;
				var data = new google.visualization.arrayToDataTable(arrayData);
				var options =
				{
					title: 'Daily by state',
					titleTextStyle : {
						fontSize: 20
					},
					chartArea: {
						left: '15%',
						top: '10%',
						width: '60%',
						height: '80%'
					},
					hAxis: {
						title: "Date",
						minorGridlines: { count:0 },
						format: 'dd-MMM'
					},
					vAxis: {
						title: "Cumulative cases",
						minorGridlines: { count:0 },
						scaleType: logScale ? 'log' : 'null',
						viewWindow: {
							min: 10
						}
					},
					legend: {
						position: 'right',
						textStyle: {fontSize: 10}
					},
					backgroundColor: {
						fill: 'FFFAFA'
					},
					<!-- witdh: '100%', -->
					<!-- height: $(window).width()*0.741*0.5-25 -->
					<!-- height: $(window).width()*0.739*0.5 -->
				};
				var chart = new google.visualization.LineChart(document.getElementById("bystate-daily"));
				var formatter = new google.visualization.DateFormat({pattern: 'dd-MMM'});
				formatter.format(data, 0);
				chart.draw(data, options);
				drawAxisLine(chart, MCO, 'MCO');
				var tDouble = Math.log(axisMax/axisMin)/Math.log(2.0);
				if(logScale)
					for(var d = 2; d <=8; d = d + 3) {
						var anchorDate = new Date(arrayData[1][0]);
						anchorDate.setDate(anchorDate.getDate() + tDouble*d);
						var textDate = new Date(arrayData[1][0]);
						textDate.setDate(textDate.getDate() + tDouble*d - 4*d);
						<!-- var max = chart.getOption('vAxis.viewWindow.max'); -->
						drawLine(chart, arrayData[1][0], axisMin, anchorDate, axisMax);
						drawText(chart, textDate, axisMax/2.0/(1.0^d), 'Double every ' + d.toString() + ' days', 8, 0);
					}
			});
				
		}
		function drawChartDailyTotalDynamics() {
			$.get("./data/dailyTotalDynamics.csv", function(csvString) {
				<!-- nationwide-dynamics -->
				var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
				var idxMCO = 0;
				for(var i = 1; i < arrayData.length; ++i) {
					arrayData[i][2] = new Date(arrayData[i][2]);
					if(arrayData[i][2].getYear() == MCO.getYear() && arrayData[i][2].getMonth() == MCO.getMonth() && arrayData[i][2].getDate() == MCO.getDate()) {
						idxMCO = i;
					}
				}
				var max = arrayData[arrayData.length-1][0];
				var axisMax = Math.pow(10, Math.ceil(Math.log(max) / Math.log(10.0)));
				var axisMin = 10.0;
				var nGridlines = Math.round(Math.log(axisMax/10.0) / Math.log(10));
				var data = new google.visualization.arrayToDataTable(arrayData);
				data.setColumnProperty(2, 'role', 'tooltip');
				var options =
				{
					title: 'Nationwide total - new vs cumulative cases',
					titleTextStyle : {
						fontSize: 20
					},
					chartArea: {
						left: '15%',
						top: '10%',
						width: '80%',
						height: '80%'
					},
					focusTarget: 'category',
					hAxis: {
						title: "Cumulative cases",
						max: axisMax,
						min: axisMin,
						minorGridlines: { count:0 },
						scaleType: 'log',
						viewWindow: {
							max: axisMax,
							min: axisMin,
						},
						<!-- gridlines: { -->
							<!-- count: 3, -->
						<!-- } -->
					},
					vAxis: {
						title: "Daily new cases",
						max: axisMax,
						min: axisMin,
						minorGridlines: { count:0 },
						scaleType: 'log',
						viewWindow: {
							max: axisMax,
							min: axisMin,
						},
						<!-- gridlines: { -->
							<!-- count: 3, -->
							<!-- <!-- count: nGridlines --> -->
						<!-- } -->
					},
					legend: {
						position: 'none',
					},
					backgroundColor: {
						fill: 'honeydew'
					},
					<!-- tooltip: { -->
						<!-- isHtml: true -->
					<!-- }, -->
					<!-- witdh: '100%', -->
					<!-- height: $(window).width()*0.739*0.5 -->
					<!-- height: $(window).width()*0.739*0.5 -->
				};
				var chart = new google.visualization.LineChart(document.getElementById("nationwide-dynamics"));
				var formatter = new google.visualization.DateFormat({pattern: 'dd-MMM'});
				formatter.format(data, 2);
				chart.draw(data, options);
				for(var i = 1; axisMin*i <= axisMax; i *= 10) {
					drawLine(chart, axisMin, axisMin*i, axisMax/i, axisMax);
					drawLine(chart, axisMin*i, axisMin, axisMax, axisMax/i);
				}
				drawText(chart, axisMax/30, axisMax/30, 'exponential growth', 14, 45.0);
				if(idxMCO > 0) {
					drawCircle(chart, arrayData[idxMCO][0], arrayData[idxMCO][1], 5, 'MCO');
				}
			});
		}
		function drawChartDailyDynamicsByStates() {
			<!-- byState-dynamics -->
			$.get("./data/byStateDynamics.csv", function(csvString) {
				var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
				<!-- idxMCOs = the first and last indices are not used -->
				var idxMCOs = new Array(arrayData[0].length);
				for(var j = 0; j < idxMCOs.length; ++j) {
					idxMCOs[j] = -1;
				}
				
				var yMax = 0;
				for(var i = 1; i < arrayData.length; ++i) {
					arrayData[i][17] = new Date(arrayData[i][17]);
					if(arrayData[i][17].getYear() == MCO.getYear() && arrayData[i][17].getMonth() == MCO.getMonth() && arrayData[i][17].getDate() == MCO.getDate()) {
						for(var j = 1; j < idxMCOs.length - 1; ++j) {
							if(arrayData[i][j] != null) {
								idxMCOs[j] = i;
								if(yMax < arrayData[i][j]) {
									yMax = arrayData[i][j];
								}
							}
						}
					}
				}
				<!-- for(var i = 1; i < arrayData.length; ++i) { -->
					<!-- for(var j = 1; j < idxMCOs.length - 1; ++j) { -->
						<!-- if(arrayData[i][j] == null) arrayData[i][j] = -1 -->
					<!-- } -->
				<!-- } -->
				var xMax = arrayData[arrayData.length-1][0];
				var axisXMax = Math.pow(10, Math.ceil(Math.log(xMax) / Math.log(10.0)));
				var axisYMax = Math.pow(10, Math.ceil(Math.log(yMax) / Math.log(10.0)));
				var axisXMin = 10.0;
				var axisYMin = 10.0;
				<!-- var nGridlines = Math.round(Math.log(axisMax/10.0) / Math.log(10)); -->
				var data = new google.visualization.arrayToDataTable(arrayData);
				for(var j = 0; j < arrayData[0].length - 1; ++j) {
					data.setColumnProperty(j, 'type', 'number');
				}
				data.setColumnProperty(17, 'role', 'tooltip');
				var options =
				{
					title: 'By state - new vs cumulative cases',
					titleTextStyle : {
						fontSize: 20
					},
					chartArea: {
						left: '10%',
						top: '10%',
						width: '70%',
						height: '80%'
					},
					focusTarget: 'category',
					interpolateNulls: true,
					lineWidth: 1,
					hAxis: {
						title: "Cumulative cases",
						max: axisXMax,
						min: axisXMin,
						minorGridlines: { count:0 },
						scaleType: 'log',
						viewWindow: {
							max: axisXMax,
							min: axisXMin,
						},
					},
					vAxis: {
						title: "Daily new cases",
						max: axisYMax,
						min: axisYMin,
						minorGridlines: { count:0 },
						scaleType: 'log',
						viewWindow: {
							max: axisYMax,
							min: axisYMin,
						},
					},
					legend: {
						position: 'right',
					},
					backgroundColor: {
						fill: 'honeydew'
					},
					<!-- tooltip: { -->
						<!-- isHtml: true -->
					<!-- }, -->
					<!-- witdh: '100%', -->
					<!-- height: $(window).width()*0.739*0.5 -->
					<!-- height: $(window).width()*0.739*0.5 -->
				};
				var chart = new google.visualization.LineChart(document.getElementById("bystate-dynamics"));
				var formatter = new google.visualization.DateFormat({pattern: 'dd-MMM'});
				formatter.format(data, 17);
				<!-- google.visualization.events.addListener(chart, 'onmouseover', function() { highlightLine(chart,data, options); }); -->
				chart.draw(data, options);
				for(var i = 1; axisXMin*i <= axisXMax && axisYMax*i <= axisXMax; i *= 10) {
					drawLine(chart, axisXMin*i, axisXMin, axisYMax*i, axisYMax);
				}
				<!-- for(var i = 1; axisYMin*i <= axisYMax and ; i *= 10) { -->
					<!-- drawLine(chart, axisXMin, axisYMin*i, axisYMax, axisYMax*i); -->
				<!-- } -->
				drawText(chart, axisYMax/3, axisYMax/3, 'exponential growth', 18, 45.0);
				<!-- if(idxMCO > 0) { -->
					<!-- drawCircle(chart, arrayData[idxMCO][0], arrayData[idxMCO][1], 5, 'MCO'); -->
				<!-- } -->
			});
		}
		function drawLine(chart, x1, y1, x2, y2) {
			var layout = chart.getChartLayoutInterface();
			var chartArea = layout.getChartAreaBoundingBox();
			var svg = chart.getContainer().getElementsByTagName('svg')[0];
			var x1Actual = layout.getXLocation(x1);
			var y1Actual = layout.getYLocation(y1);
			var x2Actual = layout.getXLocation(x2);
			var y2Actual = layout.getYLocation(y2);
			svg.appendChild(createLine(x1Actual, y1Actual, x2Actual, y2Actual, '#F08080', 1));
		}
		function highlightLine(chart,data,options) {
			var selectedLineWidth = 4;
			var selectedItem = chart.getSelection()[0];
			//reset series line width to default value
			if(selectedItem.column != null) {
				for(var i in options.series) {
					options.series[i].lineWidth = 1;
				}	
				options.series[selectedItem.column-1].lineWidth = selectedLineWidth; //set selected line width
				chart.draw(data, options);   //redraw
			}
		}
		function drawAxisLine(chart, x, text) {
			var layout = chart.getChartLayoutInterface();
			var chartArea = layout.getChartAreaBoundingBox();
			var svg = chart.getContainer().getElementsByTagName('svg')[0];
			var xLoc = layout.getXLocation(x);
			svg.appendChild(createLine(xLoc, chartArea.top + chartArea.height, xLoc, chartArea.top, '#00cccc', 4));
			svg.appendChild(createText(xLoc+10, chartArea.top + 0.1 * chartArea.height, text, '#00cccc', 18, 0));
		}
		
		function createLine(x1, y1, x2, y2, color, w) {
			var line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
			line.setAttribute('x1', x1);
			line.setAttribute('y1', y1);
			line.setAttribute('x2', x2);
			line.setAttribute('y2', y2);
			line.setAttribute('stroke', color);
			line.setAttribute('stroke-width', w);
			return line;
		}
		function drawCircle(chart, x, y, r, text) {
			var layout = chart.getChartLayoutInterface();
			var chartArea = layout.getChartAreaBoundingBox();
			var svg = chart.getContainer().getElementsByTagName('svg')[0];
			var xLoc = layout.getXLocation(x);
			var yLoc = layout.getYLocation(y);
			svg.appendChild(createCircle(xLoc, yLoc, r, '#00cccc', 4));
			svg.appendChild(createText(xLoc, yLoc+r-30, text, '#00cccc', 18, 0));
		}
		function createCircle(x, y, r, color, w) {
			var circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
			circle.setAttribute('cx', x);
			circle.setAttribute('cy', y);
			circle.setAttribute('r', r);
			circle.setAttribute('stroke', color);
			circle.setAttribute('stroke-width', w);
			circle.setAttribute('fill', color);
			return circle;
		}
		
		function drawText(chart, x, y, text, size, angleOnMesh) {
			var layout = chart.getChartLayoutInterface();
			var chartArea = layout.getChartAreaBoundingBox();
			var svg = chart.getContainer().getElementsByTagName('svg')[0];
			var xLoc = layout.getXLocation(x);
			var yLoc = layout.getYLocation(y);
			if( angleOnMesh != 0.0) {
				angle = 180.0 / Math.PI * Math.atan((layout.getYLocation(1.0+y)-yLoc)/(layout.getXLocation(1.0+x)-xLoc)*Math.tan(Math.PI/180.0*angleOnMesh));
				svg.appendChild(createText(xLoc-10, yLoc-10, text, '#F08080', size, angle));
			}
			else {
				svg.appendChild(createText(xLoc-10, yLoc-10, text, '#F08080', size, 0.0));
			}
		}
		function createText(x, y, text, color, size, angle) {
			var svgElement = document.createElementNS('http://www.w3.org/2000/svg', 'text');
			var svgText = document.createTextNode(text);
			svgElement.setAttribute('x', x);
			svgElement.setAttribute('y', y);
			svgElement.setAttribute('fill', color);
			svgElement.setAttribute('font-size', size);
			if( angle != 0) {
				svgElement.setAttribute('transform', 'rotate(' + angle.toString() + ', ' + x.toString() + ', ' + y.toString() + ')');
			}
			svgElement.appendChild(svgText);
			return svgElement;
		}
    </script>
</head>
<body>
<h1>Wuhan virus (COVID-19) statistics in Malaysia</h1>
<div id="wrapper1">
	<div id="nationwide-daily-wrapper">
		<button id="linearlogbutton" onclick="switchLinearLog();">Click to switch linear/log axis</button>
		<div id="nationwide-daily"></div>
	</div>
	<div id="nationwide-dynamics"></div>
</div>
<div class="wrapper2">
	<div><img id="malaysia-map" style="width:430; height=323;" src="Blank_malaysia_map_interactive.svg"/></div>
	<div id="bystate-daily"></div>
</div>
<div id="wrapper3">
	<div id="bystate-dynamics"></div>
</div>
<br>
<br>
<div id="reference">
Reference:
<ul>
	<li>Official Portal Ministry of Health Malaysia COVID-10 (Media Centre)<br> 
	<a href="http://www.moh.gov.my/index.php/pages/view/2019-ncov-wuhan-kenyataan-akhbar">http://www.moh.gov.my/index.php/pages/view/2019-ncov-wuhan-kenyataan-akhbar</a></li>
	<li>2020 coronavirus pandemic in Malaysia<br>
	<a href="">https://en.wikipedia.org/wiki/2020_coronavirus_pandemic_in_Malaysia</a></li>
	<li>Covid-19: Current situation in Malaysia (updated daily)<br>
	<a href="">https://www.thestar.com.my/news/nation/2020/03/23/covid-19-current-situation-in-malaysia-updated-daily</a></li>
</ul>
</body>

